<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu Nombre/Marca - Venta de Maquillaje Profesional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .product-image { height: 200px; object-fit: cover; width: 100%; cursor: pointer; }
        .whatsapp-float {
            position: fixed; width: 60px; height: 60px; bottom: 40px; right: 40px;
            background-color: #25d366; color: #FFF; border-radius: 50px;
            box-shadow: 2px 2px 3px #999; z-index: 100; display: flex;
            align-items: center; justify-content: center; padding: 10px;
        }
        .whatsapp-float img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .whatsapp-float:hover { background-color: #128C7E; }
        #admin-modal { display: none; }
        #admin-modal.show { display: flex; }
        .admin-delete-button { display: none; }
        body.admin-active .admin-delete-button { display: block; }
        .favorite-button.added { background-color: #ec4899; color: white; }
        .favorite-button.added:hover { background-color: #db2777; }

        /* Estilos Modal Imagen Grande */
        #image-modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.8);
            align-items: center; justify-content: center;
        }
         #image-modal.show { display: flex; }
        #image-modal img { display: block; margin: auto; max-width: 85%; max-height: 80vh; border-radius: 5px; }
        #image-modal-caption { text-align: center; color: #ccc; padding: 10px 0; margin-top: 10px; font-size: 1.1rem; }
        #close-image-modal { position: absolute; top: 20px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer; }
        #close-image-modal:hover, #close-image-modal:focus { color: #bbb; text-decoration: none; }

        /* Estilo para estado de carga */
        .loading-state { color: #6b7280; font-style: italic; }
    </style>
</head>
<body class="bg-pink-50 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img id="logo-placeholder" src="MATERIAL PAGINA/LOGO.png" alt="[Logo de Tu Marca Aquí]" class="h-8 md:h-10 w-auto rounded" onerror="this.style.display='none'">
                <a href="#" class="text-xl md:text-2xl font-bold text-pink-600">Tu Marca Aquí</a>
            </div>
            <div class="hidden md:flex space-x-6">
                 <a href="#inicio" class="nav-link text-gray-600 hover:text-pink-500 transition duration-300">Inicio</a>
                <a href="#productos" class="nav-link text-gray-600 hover:text-pink-500 transition duration-300">Productos</a>
                <a href="#favoritos" class="nav-link text-gray-600 hover:text-pink-500 transition duration-300">Favoritos</a>
                <a href="#nosotros" class="nav-link text-gray-600 hover:text-pink-500 transition duration-300">Nosotros</a>
                <a href="#contacto" class="nav-link text-gray-600 hover:text-pink-500 transition duration-300">Contacto</a>
            </div>
            <button class="md:hidden focus:outline-none" id="mobile-menu-button">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-gray-600"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
            </button>
        </nav>
        <div class="hidden md:hidden flex-col absolute bg-white w-full shadow-md py-4 z-40" id="mobile-menu">
             <a href="#inicio" class="nav-link block px-6 py-2 text-gray-600 hover:text-pink-500 transition duration-300">Inicio</a>
             <a href="#productos" class="nav-link block px-6 py-2 text-gray-600 hover:text-pink-500 transition duration-300">Productos</a>
             <a href="#favoritos" class="nav-link block px-6 py-2 text-gray-600 hover:text-pink-500 transition duration-300">Favoritos</a>
             <a href="#nosotros" class="nav-link block px-6 py-2 text-gray-600 hover:text-pink-500 transition duration-300">Nosotros</a>
             <a href="#contacto" class="nav-link block px-6 py-2 text-gray-600 hover:text-pink-500 transition duration-300">Contacto</a>
        </div>
    </header>

    <main>
        <section id="inicio" class="bg-gradient-to-r from-pink-200 via-purple-200 to-pink-200 py-20 md:py-32 text-center">
            <div class="container mx-auto px-6">
                <h1 class="text-4xl md:text-6xl font-bold text-gray-800 mb-4">Realza tu Belleza Natural</h1>
                <p class="text-lg md:text-xl text-gray-700 mb-8">Descubre nuestra selección exclusiva de maquillaje de alta calidad.</p>
                <a href="#productos" class="bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">Ver Productos</a>
            </div>
        </section>

        <section id="productos" class="py-16">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Nuestros Productos</h2>
                <div id="product-categories-container">
                     <p class="text-center loading-state">Cargando productos...</p>
                     </div>
                <p id="no-products-message" class="text-center text-gray-500 mt-8 hidden">No hay productos disponibles en este momento.</p>
                <p id="products-error-message" class="text-center text-red-500 mt-8 hidden">Error al cargar los productos.</p>
            </div>
        </section>

         <section id="favoritos" class="bg-pink-100 py-16">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Mis Favoritos</h2>
                 <p class="text-center text-sm text-gray-500 mb-6">(Guardados localmente en este navegador)</p>
                <div id="favorites-list" class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg">
                    <p id="no-favorites-message" class="text-center text-gray-500">No has añadido ningún producto a favoritos todavía.</p>
                     </div>
            </div>
        </section>

        <section id="nosotros" class="bg-white py-16">
            <div class="container mx-auto px-6 flex flex-col md:flex-row items-center">
                <div class="md:w-1/2 mb-8 md:mb-0 md:pr-12">
                     <img src="MATERIAL PAGINA/SOBRE.jpg" alt="[Imagen Sobre Nosotros]" class="rounded-lg shadow-lg w-full" onerror="this.onerror=null; this.src='https://placehold.co/600x400/f48fb1/ffffff?text=Imagen+no+disponible';">
                </div>
               <div class="md:w-1/2">
    <h2 class="text-3xl font-bold text-gray-800 mb-4">Conoce a [Tu Nombre/Marca]</h2>
    <p class="text-gray-600 mb-4 leading-relaxed text-justify">
        ¡Hola! Soy [Tu Nombre], apasionada por el mundo del maquillaje y dedicada a ofrecerte productos de la más alta calidad que te hagan sentir segura y radiante. Mi misión es ayudarte a encontrar los cosméticos perfectos que resalten tu belleza única.
    </p>
    <p class="text-gray-600 leading-relaxed text-justify">
        Selecciono cuidadosamente cada artículo, asegurándome de que cumpla con los estándares de calidad y las últimas tendencias. ¡Explora la colección y déjate inspirar!
    </p>
</div>

            </div>
        </section>

        <section id="contacto" class="bg-pink-50 py-16">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Ponte en Contacto</h2>
                <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                    <form id="contact-form">
                        <div class="mb-4">
                            <label for="name" class="block text-gray-700 font-semibold mb-2">Nombre</label>
                            <input type="text" id="name" name="name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400" placeholder="Tu Nombre Completo" required>
                        </div>
                        <div class="mb-4">
                            <label for="email" class="block text-gray-700 font-semibold mb-2">Correo Electrónico</label>
                            <input type="email" id="email" name="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400" placeholder="tuemail@ejemplo.com" required>
                        </div>
                        <div class="mb-6">
                            <label for="message" class="block text-gray-700 font-semibold mb-2">Mensaje</label>
                            <textarea id="message" name="message" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400" placeholder="Escribe tu consulta aquí..." required></textarea>
                        </div>
                        <div class="text-center">
                            <button type="submit" id="submit-contact-form" class="bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                                Enviar Mensaje y Favoritos
                            </button>
                        </div>
                    </form>
                    <div id="form-status" class="text-center mt-4 text-sm"></div>
                    <p class="text-center text-gray-600 mt-8">
                        También puedes contactarme por <a href="mailto:tuemail@ejemplo.com" class="text-pink-600 hover:underline">email</a> o seguirme en redes sociales.
                    </p>
                     <div class="flex justify-center space-x-4 mt-4">
                        <a href="#" class="text-pink-500 hover:text-pink-700 transition duration-300" aria-label="Instagram"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg></a>
                        <a href="#" class="text-pink-500 hover:text-pink-700 transition duration-300" aria-label="Twitter"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-.424.727-.666 1.561-.666 2.477 0 1.921.977 3.614 2.464 4.61a4.823 4.823 0 0 1-2.229-.616c-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.548z"/></svg></a>
                         <a href="#" class="text-pink-500 hover:text-pink-700 transition duration-300" aria-label="Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/></svg></a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 [Tu Nombre/Marca]. Todos los derechos reservados.</p>
            <p class="text-sm text-gray-400 mt-2">Diseñado con ❤️</p>
            <div class="mt-4">
                <button id="admin-button" class="bg-gray-600 hover:bg-gray-700 text-white text-xs font-semibold py-1 px-3 rounded-full transition duration-300">
                    Administrador
                </button>
                 <button id="logout-admin-button" class="admin-delete-button ml-2 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-semibold py-1 px-3 rounded-full transition duration-300">
                    Salir Modo Admin
                </button>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/TUNUMERODETELEFONO?text=Hola%2C%20estoy%20interesado%2For%20en%20tus%20productos%20de%20maquillaje." class="whatsapp-float" target="_blank" aria-label="Contactar por WhatsApp">
         <img src="MATERIAL PAGINA/WH.png" alt="WhatsApp Logo">
    </a>

    <div id="admin-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 items-center justify-center z-50 px-4 overflow-y-auto py-10">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Añadir Nuevo Producto</h3>
                <button id="close-admin-modal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="add-product-form">
                <div class="mb-4">
                    <label for="product-name" class="block text-gray-700 font-semibold mb-2">Nombre Producto</label>
                    <input type="text" id="product-name" name="product-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400" required>
                </div>
                <div class="mb-4">
                    <label for="product-description" class="block text-gray-700 font-semibold mb-2">Descripción</label>
                    <textarea id="product-description" name="product-description" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400" required></textarea>
                </div>
                 <div class="mb-4">
                    <label for="product-category" class="block text-gray-700 font-semibold mb-2">Categoría</label>
                    <input type="text" id="product-category" name="product-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400" placeholder="Ej: Labiales, Bases, Sombras" required>
                </div>
                <div class="mb-4">
                    <label for="product-price" class="block text-gray-700 font-semibold mb-2">Precio ($)</label>
                    <input type="number" id="product-price" name="product-price" step="0.01" min="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400" required>
                </div>
                 <div class="mb-6">
                    <label for="product-image-file" class="block text-gray-700 font-semibold mb-2">Imagen del Producto</label>
                    <input type="file" id="product-image-file" name="product-image-file" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100" required>
                 </div>
                <div class="text-right">
                    <button type="submit" id="save-product-button" class="bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 px-6 rounded-lg shadow transition duration-300">Guardar Producto</button>
                </div>
                 <p id="admin-form-status" class="text-sm text-center mt-4"></p>
            </form>
        </div>
    </div>

    <div id="image-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 items-center justify-center z-1000 px-4 hidden">
        <div class="relative max-w-4xl max-h-full">
             <span id="close-image-modal" class="absolute top-0 right-0 mt-1 mr-1 md:-mt-4 md:-mr-4 text-white text-4xl font-bold cursor-pointer hover:text-gray-300 z-50">&times;</span>
             <img id="modal-image-content" src="#" alt="[Imagen ampliada del producto]" class="block mx-auto rounded-lg shadow-lg">
             <div id="image-modal-caption" class="text-center text-gray-300 mt-3 text-lg"></div>
        </div>
    </div>


    <script>
        // --- Configuración ---
        // !! INICIO: VALORES INSERTADOS POR EL USUARIO !!
        const SUPABASE_URL = 'https://xlomfplzufpxvmyllypd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsb21mcGx6dWZweHZteWxseXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4NDc4ODYsImV4cCI6MjA2MDQyMzg4Nn0.thYZxLQMEHL-JR0kUXGX1jZeChSc84QwMCimID4NNMQ';
        // !! FIN: VALORES INSERTADOS POR EL USUARIO !!

        const FORM_ENDPOINT = "https://formspree.io/f/mjkydbke"; // Endpoint Formspree
        const ADMIN_PASSWORD = "1234"; // ¡¡CAMBIAR ESTO!!
        const FAVORITES_STORAGE_KEY = 'makeupFavorites_v2'; // Clave para favoritos locales
        const IMAGE_BUCKET_NAME = 'images'; // Nombre de tu bucket público en Supabase

        // --- Inicialización Supabase ---
        let supabase = null;
        try {
            if (window.supabase) {
                 supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                 console.log("Supabase client initialized.");
            } else {
                console.error("Supabase client library not loaded.");
                throw new Error("Supabase library not available.");
            }
        } catch (error) {
             console.error("Failed to initialize Supabase:", error);
             alert("Error crítico: No se pudo inicializar la conexión con la base de datos.");
             // Deshabilitar funcionalidades que dependen de Supabase si falla la inicialización
             // (Opcional, pero buena práctica)
        }


        // --- Elementos del DOM ---
        // (Se obtienen los elementos igual que antes)
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const navLinks = document.querySelectorAll('.nav-link');
        const adminButton = document.getElementById('admin-button');
        const logoutAdminButton = document.getElementById('logout-admin-button');
        const adminModal = document.getElementById('admin-modal');
        const closeAdminModalButton = document.getElementById('close-admin-modal');
        const addProductForm = document.getElementById('add-product-form');
        const productImageFile = document.getElementById('product-image-file');
        const saveProductButton = document.getElementById('save-product-button');
        const adminFormStatus = document.getElementById('admin-form-status');
        const productCategoriesContainer = document.getElementById('product-categories-container');
        const noProductsMessage = document.getElementById('no-products-message');
        const productsErrorMessage = document.getElementById('products-error-message');
        const favoritesListContainer = document.getElementById('favorites-list');
        const noFavoritesMessage = document.getElementById('no-favorites-message');
        const contactForm = document.getElementById('contact-form');
        const formStatus = document.getElementById('form-status');
        const imageModal = document.getElementById('image-modal');
        const modalImageContent = document.getElementById('modal-image-content');
        const imageModalCaption = document.getElementById('image-modal-caption');
        const closeImageModalButton = document.getElementById('close-image-modal');

        // --- Estado de la Aplicación ---
        let isAdminActive = false;

        // --- Inicialización ---
        document.addEventListener('DOMContentLoaded', () => {
            if (supabase) {
                 loadProducts(); // Cargar productos desde Supabase
            } else {
                 // Mostrar error si Supabase no se inicializó
                 productCategoriesContainer.innerHTML = '<p class="text-center text-red-500">Error al conectar con la base de datos.</p>';
                 noProductsMessage.classList.add('hidden');
                 productsErrorMessage.classList.remove('hidden'); // Mostrar mensaje de error específico
                 productsErrorMessage.textContent = 'Error: No se pudo inicializar la conexión con Supabase.';
            }
            loadFavorites(); // Cargar favoritos desde localStorage
            setupEventListeners();
        });

        // --- Funciones Principales ---

        function setupEventListeners() {
            // Menú Móvil
            if (mobileMenuButton && mobileMenu) mobileMenuButton.addEventListener('click', toggleMobileMenu);
            navLinks.forEach(link => link.addEventListener('click', handleNavLinkClick));
            document.addEventListener('click', handleClickOutsideMenu);

            // Admin
            adminButton.addEventListener('click', handleAdminLogin);
            logoutAdminButton.addEventListener('click', handleAdminLogout);
            closeAdminModalButton.addEventListener('click', hideAdminModal);
            adminModal.addEventListener('click', handleClickOutsideAdminModal);
            addProductForm.addEventListener('submit', handleAddProduct);

            // Formulario de Contacto
            contactForm.addEventListener('submit', handleContactFormSubmit);

            // Modal Imagen Grande
            closeImageModalButton.addEventListener('click', hideImageModal);
            imageModal.addEventListener('click', (event) => {
                 if (event.target === imageModal) hideImageModal();
            });
        }

        // --- Lógica de Productos (CON SUPABASE) ---

        async function loadProducts() {
            if (!supabase) return;

            productCategoriesContainer.innerHTML = '<p class="text-center loading-state">Cargando productos...</p>';
            noProductsMessage.classList.add('hidden');
            productsErrorMessage.classList.add('hidden');
            productCategoriesContainer.classList.remove('hidden');

            try {
                const { data: products, error } = await supabase
                    .from('products')
                    .select('*')
                    .order('category', { ascending: true })
                    .order('name', { ascending: true });

                if (error) throw error;

                productCategoriesContainer.innerHTML = '';

                if (!products || products.length === 0) {
                    noProductsMessage.classList.remove('hidden');
                    productCategoriesContainer.classList.add('hidden');
                } else {
                    noProductsMessage.classList.add('hidden');
                    productCategoriesContainer.classList.remove('hidden');

                    const productsByCategory = products.reduce((acc, product) => {
                        const category = product.category || 'Sin Categoría';
                        if (!acc[category]) acc[category] = [];
                        acc[category].push(product);
                        return acc;
                    }, {});

                    const sortedCategories = Object.keys(productsByCategory).sort();

                    sortedCategories.forEach(category => {
                        const categorySection = document.createElement('div');
                        categorySection.className = 'mb-12';
                        const categoryTitle = document.createElement('h3');
                        categoryTitle.className = 'text-2xl font-semibold text-pink-700 mb-6 border-b-2 border-pink-200 pb-2';
                        categoryTitle.textContent = category;
                        categorySection.appendChild(categoryTitle);
                        const categoryGrid = document.createElement('div');
                        categoryGrid.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8';

                        productsByCategory[category].forEach(product => {
                            let imageUrl = `https://placehold.co/600x400/f0f0f0/ffffff?text=No+img+path`;
                            if (product.image_path) {
                                const { data: urlData } = supabase.storage.from(IMAGE_BUCKET_NAME).getPublicUrl(product.image_path);
                                if (urlData && urlData.publicUrl) {
                                    imageUrl = urlData.publicUrl;
                                } else {
                                     console.warn(`No se pudo obtener URL pública para: ${product.image_path}`);
                                     imageUrl = `https://placehold.co/600x400/f0f0f0/ffffff?text=URL+Error`;
                                }
                            }
                            const cardElement = document.createElement('div');
                            cardElement.innerHTML = createProductCardHTML(product, imageUrl);
                            const imgElement = cardElement.querySelector('.product-image');
                            if (imgElement) {
                                imgElement.addEventListener('click', () => showImageModal(imageUrl, product.name));
                            }
                            categoryGrid.appendChild(cardElement.firstElementChild);
                        });
                        categorySection.appendChild(categoryGrid);
                        productCategoriesContainer.appendChild(categorySection);
                    });
                }
                addProductActionListeners();

            } catch (error) {
                console.error("Error cargando productos desde Supabase:", error);
                productCategoriesContainer.innerHTML = '';
                productsErrorMessage.textContent = `Error al cargar productos: ${error.message}`;
                productsErrorMessage.classList.remove('hidden');
                productCategoriesContainer.classList.add('hidden');
                noProductsMessage.classList.add('hidden');
            }
        }

        function createProductCardHTML(product, imageUrl) {
            const isFav = isFavorite(product.name);
            const favButtonClass = isFav ? 'added' : '';
            const favButtonText = isFav ? 'Quitar de Favoritos' : 'Añadir a Favoritos';

            return `
                <div class="bg-white rounded-lg shadow-lg overflow-hidden transform hover:shadow-xl transition duration-300 flex flex-col relative">
                    <button data-id="${product.id}" data-image-path="${product.image_path || ''}" class="admin-delete-button absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white text-xs font-bold p-1 rounded-full z-10" title="Eliminar Producto">
                        &times;
                    </button>
                    <img src="${imageUrl}" alt="[Imagen de ${product.name}]" class="w-full product-image">
                    <div class="p-6 flex flex-col flex-grow">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">${product.name}</h3>
                        <p class="text-gray-600 mb-2 text-sm italic text-pink-600">${product.category || 'Sin Categoría'}</p>
                        <p class="text-gray-600 mb-4 flex-grow">${product.description}</p>
                        <div class="mt-auto">
                            <span class="text-lg font-bold text-pink-600">$${product.price.toFixed(2)}</span>
                            <button data-name="${product.name}" class="favorite-button ${favButtonClass} mt-4 w-full border border-pink-500 text-pink-600 hover:bg-pink-100 font-semibold py-2 px-4 rounded-lg transition duration-300">
                                ${favButtonText}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function addProductActionListeners() {
            document.querySelectorAll('.favorite-button').forEach(button => {
                 button.removeEventListener('click', handleFavoriteToggle);
                 button.addEventListener('click', handleFavoriteToggle);
            });
            document.querySelectorAll('.admin-delete-button').forEach(button => {
                button.removeEventListener('click', handleDeleteProduct);
                button.addEventListener('click', handleDeleteProduct);
            });
        }

        // --- Lógica de Favoritos (localStorage) ---
        function loadFavorites() {
            const favorites = getFavorites();
            favoritesListContainer.innerHTML = '';
            if (favorites.length === 0) {
                noFavoritesMessage.classList.remove('hidden');
            } else {
                noFavoritesMessage.classList.add('hidden');
                favorites.forEach(favName => {
                    favoritesListContainer.innerHTML += createFavoriteItemHTML(favName);
                });
                addRemoveFavoriteListeners();
            }
        }
        function createFavoriteItemHTML(productName) {
             return `
                <div class="flex justify-between items-center border-b border-gray-200 py-3">
                    <span class="text-gray-700">${productName}</span>
                    <button data-name="${productName}" class="remove-favorite-button text-red-500 hover:text-red-700 text-sm font-semibold">Quitar</button>
                </div>
            `;
        }
        function addRemoveFavoriteListeners() {
            document.querySelectorAll('.remove-favorite-button').forEach(button => {
                 button.removeEventListener('click', handleRemoveFavorite);
                 button.addEventListener('click', handleRemoveFavorite);
            });
        }
        function getFavorites() {
            const favJson = localStorage.getItem(FAVORITES_STORAGE_KEY);
            return favJson ? JSON.parse(favJson) : [];
        }
        function saveFavorites(favorites) {
            localStorage.setItem(FAVORITES_STORAGE_KEY, JSON.stringify(favorites));
        }
        function isFavorite(productName) {
            return getFavorites().includes(productName);
        }
        function addToFavorites(productName) {
            const favorites = getFavorites();
            if (!favorites.includes(productName)) {
                favorites.push(productName);
                saveFavorites(favorites);
            }
        }
        function removeFromFavorites(productName) {
            let favorites = getFavorites();
            favorites = favorites.filter(name => name !== productName);
            saveFavorites(favorites);
        }

        // --- Manejadores de Eventos (Favoritos) ---
        function handleFavoriteToggle(event) {
            const button = event.target;
            const productName = button.getAttribute('data-name');
            if (isFavorite(productName)) {
                removeFromFavorites(productName);
                button.classList.remove('added');
                button.textContent = 'Añadir a Favoritos';
            } else {
                addToFavorites(productName);
                button.classList.add('added');
                button.textContent = 'Quitar de Favoritos';
            }
            loadFavorites();
        }
         function handleRemoveFavorite(event) {
            const productName = event.target.getAttribute('data-name');
            removeFromFavorites(productName);
            loadFavorites();
            loadProducts();
        }

        // --- Lógica de Imagen Modal ---
        function showImageModal(imageUrl, caption) {
            if (!imageUrl || imageUrl.includes('placehold.co')) return;
            modalImageContent.src = imageUrl;
            imageModalCaption.textContent = caption || '';
            imageModal.classList.add('show');
            imageModal.classList.remove('hidden');
        }
        function hideImageModal() {
            imageModal.classList.add('hidden');
            imageModal.classList.remove('show');
            modalImageContent.src = '#';
            imageModalCaption.textContent = '';
        }


        // --- Lógica Admin (CON SUPABASE) ---
        async function handleAddProduct(event) {
            event.preventDefault();
            if (!supabase) { alert("Error: Supabase no está conectado."); return; }

            saveProductButton.disabled = true;
            adminFormStatus.textContent = 'Guardando...';
            adminFormStatus.className = 'text-sm text-center mt-4 text-blue-600';

            const name = document.getElementById('product-name').value.trim();
            const description = document.getElementById('product-description').value.trim();
            const category = document.getElementById('product-category').value.trim() || 'Sin Categoría';
            const price = parseFloat(document.getElementById('product-price').value);
            const imageFile = productImageFile.files[0];

            if (!name || !description || !category || isNaN(price) || price <= 0 || !imageFile) {
                alert('Completa todos los campos y selecciona una imagen.');
                saveProductButton.disabled = false;
                adminFormStatus.textContent = 'Error: Faltan datos.';
                adminFormStatus.className = 'text-sm text-center mt-4 text-red-600';
                return;
            }

            try {
                const fileExt = imageFile.name.split('.').pop();
                const fileName = `${Date.now()}.${fileExt}`;
                const filePath = `${fileName}`;

                adminFormStatus.textContent = 'Subiendo imagen...';
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from(IMAGE_BUCKET_NAME)
                    .upload(filePath, imageFile);

                if (uploadError) throw new Error(`Error al subir imagen: ${uploadError.message}`);

                console.log('Image uploaded:', uploadData);
                adminFormStatus.textContent = 'Imagen subida. Guardando datos...';

                const { data: insertData, error: insertError } = await supabase
                    .from('products')
                    .insert([{ name, description, category, price, image_path: filePath }])
                    .select();

                if (insertError) {
                    await supabase.storage.from(IMAGE_BUCKET_NAME).remove([filePath]); // Rollback imagen
                    throw new Error(`Error al guardar producto: ${insertError.message}`);
                }

                console.log('Product inserted:', insertData);
                adminFormStatus.textContent = '¡Producto guardado con éxito!';
                adminFormStatus.className = 'text-sm text-center mt-4 text-green-600';

                addProductForm.reset();
                hideAdminModal();
                await loadProducts();

            } catch (error) {
                console.error('Error en handleAddProduct:', error);
                adminFormStatus.textContent = `Error: ${error.message}`;
                adminFormStatus.className = 'text-sm text-center mt-4 text-red-600';
            } finally {
                saveProductButton.disabled = false;
                setTimeout(() => { adminFormStatus.textContent = ''; }, 5000);
            }
        }

         async function handleDeleteProduct(event) {
            if (!isAdminActive || !supabase) return;

            const button = event.target;
            const productId = parseInt(button.getAttribute('data-id'));
            const imagePath = button.getAttribute('data-image-path');

            if (isNaN(productId)) { console.error("ID de producto inválido."); return; }

            if (confirm(`¿Eliminar este producto (ID: ${productId})?`)) {
                 button.disabled = true; button.textContent = '...';
                try {
                    const { error: deleteDbError } = await supabase.from('products').delete().eq('id', productId);
                    if (deleteDbError) throw new Error(`Error al borrar de DB: ${deleteDbError.message}`);
                    console.log(`Product ${productId} deleted from DB.`);

                    if (imagePath) {
                        const { error: removeStorageError } = await supabase.storage.from(IMAGE_BUCKET_NAME).remove([imagePath]);
                        if (removeStorageError) console.warn(`No se pudo borrar imagen ${imagePath}:`, removeStorageError.message);
                        else console.log(`Image ${imagePath} deleted from Storage.`);
                    } else { console.log(`Sin image path para ${productId}, omitiendo borrado de storage.`); }

                    await loadProducts();
                } catch (error) {
                    console.error('Error eliminando producto:', error);
                    alert(`Error al eliminar: ${error.message}`);
                    button.disabled = false; button.textContent = '×';
                }
            }
        }

        // --- Lógica Formulario Contacto ---
        async function handleContactFormSubmit(event) {
            event.preventDefault();
            const submitButton = document.getElementById('submit-contact-form');
            submitButton.disabled = true;
            formStatus.textContent = 'Enviando...';
            formStatus.className = 'text-center mt-4 text-sm text-blue-600';

            const formData = new FormData(contactForm);
            const name = formData.get('name');
            const email = formData.get('email');
            const message = formData.get('message');
            const favorites = getFavorites(); // De localStorage
            let messageBody = `Nombre: ${name}\nEmail: ${email}\n\nMensaje:\n${message}\n\n`;
            if (favorites.length > 0) {
                messageBody += "--- Favoritos Seleccionados (Local) ---\n";
                favorites.forEach(fav => { messageBody += `- ${fav}\n`; });
            } else {
                 messageBody += "--- (No seleccionó favoritos) ---";
            }
            const dataToSend = { name, email, message: messageBody, _subject: `Nuevo Mensaje de Contacto de ${name}` };

            try {
                const response = await fetch(FORM_ENDPOINT, {
                    method: 'POST', headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify(dataToSend)
                });
                if (response.ok) {
                    formStatus.textContent = '¡Mensaje y favoritos enviados!';
                    formStatus.className = 'text-center mt-4 text-sm text-green-600';
                    contactForm.reset();
                } else {
                    const responseData = await response.json();
                     formStatus.textContent = `Error: ${responseData.error || 'Inténtalo de nuevo.'}`;
                     formStatus.className = 'text-center mt-4 text-sm text-red-600';
                }
            } catch (error) {
                console.error('Error fetch:', error);
                formStatus.textContent = 'Error de red. Inténtalo de nuevo.';
                formStatus.className = 'text-center mt-4 text-sm text-red-600';
            } finally {
                 submitButton.disabled = false;
                 setTimeout(() => { formStatus.textContent = ''; }, 5000);
            }
        }

        // --- Lógica de Admin (Login/Logout, Modal) ---
        function handleAdminLogin() {
            const passwordAttempt = prompt("Introduce la contraseña de administrador:");
            if (passwordAttempt === ADMIN_PASSWORD) {
                isAdminActive = true;
                document.body.classList.add('admin-active');
                showAdminModal();
            } else if (passwordAttempt !== null) {
                alert("Contraseña incorrecta.");
                isAdminActive = false;
                 document.body.classList.remove('admin-active');
            }
        }
        function handleAdminLogout() {
             isAdminActive = false;
             document.body.classList.remove('admin-active');
             hideAdminModal();
             alert("Has salido del modo administrador.");
        }
        function showAdminModal() {
             addProductForm.reset();
             adminFormStatus.textContent = '';
             adminModal.classList.add('show');
        }
        function hideAdminModal() {
            adminModal.classList.remove('show');
        }
         function handleClickOutsideAdminModal(event) {
            if (event.target === adminModal) hideAdminModal();
        }

        // --- Lógica del Menú Móvil ---
        function toggleMobileMenu() {
             mobileMenu.classList.toggle('hidden');
             mobileMenu.classList.toggle('flex');
        }
        function handleNavLinkClick(event) {
            if (!mobileMenu.classList.contains('hidden')) toggleMobileMenu();
            const link = event.target.closest('a');
            if (link) {
                const targetId = link.getAttribute('href');
                 if (targetId && targetId.startsWith('#')) {
                    event.preventDefault();
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        setTimeout(() => { targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 50);
                    }
                }
            }
        }
        function handleClickOutsideMenu(event) {
          const isClickInsideMenu = mobileMenu.contains(event.target);
          const isClickOnButton = mobileMenuButton.contains(event.target);
          if (!isClickInsideMenu && !isClickOnButton && !mobileMenu.classList.contains('hidden')) {
            toggleMobileMenu();
          }
        }

    </script>

</body>
</html>

